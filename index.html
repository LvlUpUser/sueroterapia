<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cl√≠nica 4 Elements - Protocolos IV</title>
    
    <!-- Librer√≠as Externas -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Configuraci√≥n Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        medical: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        @media print {
            body * { visibility: hidden; }
            #print-section, #print-section * { visibility: visible; }
            #print-section {
                position: absolute;
                left: 0; top: 0;
                width: 100%;
                margin: 0; padding: 0;
                background: white;
            }
            .no-print { display: none !important; }
            @page { margin: 0; size: A4; }
        }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased selection:bg-medical-100">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS SVG ---
        const Icon = ({ name, className }) => {
            const icons = {
                printer: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>,
                trash: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
                search: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
                mic: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="23"/><line x1="8" x2="16" y1="23" y2="23"/></svg>,
                alert: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
                euro: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2"/></svg>,
                clock: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
                droplet: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22a7 7 0 0 0 7-7c0-2-5-9-5-9S9 13 9 15a7 7 0 0 0 3 7z"/></svg>,
                user: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
                check: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg>
            };
            return icons[name] || null;
        };

        // --- PRECIOS POR ML (Basado en Facturas Barrachina) ---
        // Precios estimados para c√°lculo interno
        const PRICES = {
            suero500: 2.50,
            suero250: 2.20,
            vitC: 0.50,      // aprox
            gluta: 1.00,     // 10ml = 10‚Ç¨ aprox
            bComplex: 0.60,  // Variable
            magnesio: 0.40, 
            calcio: 1.20,    // 5ml = 6‚Ç¨
            procaina: 0.50,
            nad: 15.00,      // 10ml = 150‚Ç¨ (Costoso)
            carnitina: 0.90,
            oligo: 1.00,
            zinc: 0.50,
            inositol: 0.40,  // 20ml = 8‚Ç¨
            biotina: 1.20,   // 5ml = 6‚Ç¨
            b5: 1.60,        // 5ml = 8‚Ç¨
            arginina: 0.80,  
            taurina: 0.50,   // 20ml = 10‚Ç¨
            triptofano: 0.50 // 20ml = 10‚Ç¨
        };

        // --- BASE DE DATOS PROTOCOLOS ---
        const PROTOCOLS_DB = [
            // 1
            {
                id: 'equilibrio-vital',
                name: '1Ô∏è‚É£ Equilibrio Vital Mujer',
                subtext: 'Menopausia / Perimenopausia',
                target: ['sofocos', 'insomnio', 'ansiedad', 'fatiga', 'sequedad', 'menopausia'],
                time: '60‚Äì75 min',
                speed: 'Lenta, continua',
                alerts: 'Antidepresivos/ISRS (Valorar Tript√≥fano). Sensaci√≥n calor (Calcio).',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "Tript√≥fano 10 mg/ml", qty: 10, unit: 'ml', price: PRICES.triptofano * 10 },
                    { name: "Sulfato Magnesio 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.magnesio * 10 },
                    { name: "Vitamina C 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.vitC * 10 },
                    { name: "Cloruro Calcio 100 mg/ml", qty: 5, unit: 'ml', price: PRICES.calcio * 5 },
                    { name: "Complejo B", qty: 5, unit: 'ml', price: PRICES.bComplex * 5 }
                ]
            },
            // 2
            {
                id: 'mujer-calma',
                name: '2Ô∏è‚É£ Mujer en Calma',
                subtext: 'Endometriosis / Dolor P√©lvico',
                target: ['endometriosis', 'dolor', 'inflamaci√≥n', 'cansancio', 'pelvico'],
                time: '75‚Äì90 min',
                speed: 'Muy lenta',
                alerts: 'Riesgo Hipotensi√≥n. Sensibilidad anest√©sicos (Proca√≠na).',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "Glutati√≥n Reducido 150 mg/ml", qty: 20, unit: 'ml', price: PRICES.gluta * 20 },
                    { name: "Vitamina C 500 mg/ml", qty: 20, unit: 'ml', price: PRICES.vitC * 20 },
                    { name: "Sulfato Magnesio 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.magnesio * 10 },
                    { name: "Proca√≠na 1%", qty: 5, unit: 'ml', price: PRICES.procaina * 5 }
                ]
            },
            // 3
            {
                id: 'origen-vida',
                name: '3Ô∏è‚É£ Origen Vida',
                subtext: 'Fertilidad Femenina y Masculina',
                target: ['fertilidad', 'embarazo', 'ovarios', 'espermatozoides', 'reserva'],
                time: '90 min',
                speed: 'Primera mitad lenta, NAD+ muy lento',
                alerts: 'Primera exposici√≥n NAD+. Posible ansiedad/palpitaciones.',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "NAD+ 100 mg/ml", qty: 5, unit: 'ml', price: PRICES.nad * 5 },
                    { name: "L-Carnitina 200 mg/ml", qty: 10, unit: 'ml', price: PRICES.carnitina * 10 },
                    { name: "Oligoelementos (Zn/Se)", qty: 10, unit: 'ml', price: PRICES.oligo * 10 },
                    { name: "Vitamina C 500 mg/ml", qty: 5, unit: 'ml', price: PRICES.vitC * 5 }
                ]
            },
            // 4
            {
                id: 'reinicio-metabolico',
                name: '4Ô∏è‚É£ Reinicio Metab√≥lico',
                subtext: 'Control de Peso / Resistencia',
                target: ['peso', 'adelgazar', 'grasa', 'metabolismo', 'dieta'],
                time: '60 min',
                speed: 'Media',
                alerts: 'Hipoglucemias en pacientes tratados. D√©ficit renal avanzado.',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "L-Carnitina 200 mg/ml", qty: 10, unit: 'ml', price: PRICES.carnitina * 10 },
                    { name: "Inositol 50 mg/ml", qty: 10, unit: 'ml', price: PRICES.inositol * 10 },
                    { name: "Glutati√≥n Reducido 150 mg/ml", qty: 10, unit: 'ml', price: PRICES.gluta * 10 },
                    { name: "Oligoelementos (Zn/Cromo)", qty: 5, unit: 'ml', price: PRICES.oligo * 5 }
                ]
            },
            // 5
            {
                id: 'raiz-fuerte',
                name: '5Ô∏è‚É£ Ra√≠z Fuerte',
                subtext: 'Cabello / U√±as / Faneras',
                target: ['cabello', 'pelo', 'ca√≠da', 'u√±as', 'alopecia'],
                time: '45‚Äì60 min',
                speed: 'Media',
                alerts: 'Avisar: Biotina puede alterar anal√≠ticas tiroideas.',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "Biotina 2.5 mg/ml", qty: 10, unit: 'ml', price: PRICES.biotina * 10 },
                    { name: "Vitamina B5 250 mg/ml", qty: 5, unit: 'ml', price: PRICES.b5 * 5 },
                    { name: "Oligoelementos (Zn/Se)", qty: 10, unit: 'ml', price: PRICES.oligo * 10 },
                    { name: "Vitamina C 500 mg/ml", qty: 5, unit: 'ml', price: PRICES.vitC * 5 }
                ]
            },
            // 6
            {
                id: 'piel-dentro',
                name: '6Ô∏è‚É£ Piel desde Dentro',
                subtext: 'Glow / Antiaging',
                target: ['piel', 'arrugas', 'luminosidad', 'manchas', 'cara'],
                time: '60‚Äì75 min',
                speed: 'Lenta',
                alerts: 'Migra√±a inducida por Vit C alta. Sensibilidad grupo B.',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 250, unit: 'ml', price: PRICES.suero250, type: 'base' },
                    { name: "Glutati√≥n Reducido 150 mg/ml", qty: 20, unit: 'ml', price: PRICES.gluta * 20 },
                    { name: "Vitamina C 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.vitC * 10 },
                    { name: "Biotina 2.5 mg/ml", qty: 5, unit: 'ml', price: PRICES.biotina * 5 },
                    { name: "Complejo B", qty: 5, unit: 'ml', price: PRICES.bComplex * 5 }
                ]
            },
            // 7
            {
                id: 'impulso-activo',
                name: '7Ô∏è‚É£ Impulso Activo',
                subtext: 'Deporte / Recuperaci√≥n',
                target: ['deporte', 'musculo', 'lesion', 'recuperacion', 'cansancio'],
                time: '60‚Äì75 min',
                speed: 'Media',
                alerts: 'Hipotensi√≥n (Arginina). Cuidado con otros vasodilatadores.',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "L-Arginina 20%", qty: 10, unit: 'ml', price: PRICES.arginina * 10 },
                    { name: "L-Carnitina 200 mg/ml", qty: 10, unit: 'ml', price: PRICES.carnitina * 10 },
                    { name: "Sulfato Magnesio 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.magnesio * 10 },
                    { name: "Taurina 50 mg/ml", qty: 10, unit: 'ml', price: PRICES.taurina * 10 }
                ]
            },
            // 8
            {
                id: 'reset-celular',
                name: '8Ô∏è‚É£ Reset Celular',
                subtext: 'Myers Cl√°sico / Bienestar',
                target: ['reset', 'estr√©s', 'bajada', 'general', 'cronico'],
                time: '45‚Äì60 min',
                speed: 'Media',
                alerts: 'Ansiedad/Insomnio. Hipersensibilidad B3 (Flush).',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "Complejo B", qty: 10, unit: 'ml', price: PRICES.bComplex * 10 },
                    { name: "Vitamina C 500 mg/ml", qty: 15, unit: 'ml', price: PRICES.vitC * 15 },
                    { name: "Sulfato Magnesio 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.magnesio * 10 }
                ]
            },
            // 9
            {
                id: 'intestino-equilibrio',
                name: '9Ô∏è‚É£ Intestino en Equilibrio',
                subtext: 'SIBO / Disbiosis',
                target: ['sibo', 'barriga', 'gases', 'diarrea', 'estre√±imiento'],
                time: '60‚Äì75 min',
                speed: 'Lenta',
                alerts: 'Gases por tript√≥fano. Retirar tript√≥fano en SIBO Metano.',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "Vitamina C 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.vitC * 10 },
                    { name: "Oligoelementos (Zinc)", qty: 5, unit: 'ml', price: PRICES.zinc * 5 },
                    { name: "Tript√≥fano 10 mg/ml", qty: 10, unit: 'ml', price: PRICES.triptofano * 10 },
                    { name: "Glutati√≥n Reducido 150 mg/ml", qty: 5, unit: 'ml', price: PRICES.gluta * 5 }
                ]
            },
            // 10
            {
                id: 'calma-interior',
                name: 'üîü Calma Interior',
                subtext: 'Ansiedad / Insomnio',
                target: ['ansiedad', 'insomnio', 'nervios', 'panico'],
                time: '60‚Äì75 min',
                speed: 'Lenta',
                alerts: 'CR√çTICO: Bipolaridad / Antidepresivos Severos. (VERSI√ìN SIN TRIPT√ìFANO).',
                ingredients: [
                    { name: "Suero Fisiol√≥gico 0.9%", qty: 500, unit: 'ml', price: PRICES.suero500, type: 'base' },
                    { name: "Sulfato Magnesio 500 mg/ml", qty: 10, unit: 'ml', price: PRICES.magnesio * 10 },
                    { name: "Taurina 50 mg/ml", qty: 10, unit: 'ml', price: PRICES.taurina * 10 },
                    { name: "Inositol 50 mg/ml", qty: 10, unit: 'ml', price: PRICES.inositol * 10 },
                    { name: "Tript√≥fano 10 mg/ml", qty: 10, unit: 'ml', price: PRICES.triptofano * 10 }
                ]
            }
        ];

        // --- COMPONENTE PRINCIPAL ---
        function SueroterapiaApp() {
            const [patient, setPatient] = useState({ name: '', age: '', sex: '', symptoms: '' });
            const [selectedProtocol, setSelectedProtocol] = useState(null);
            const [isListening, setIsListening] = useState(false);
            const [showReport, setShowReport] = useState(false);

            // Calcular coste total
            const calculateTotalCost = (ingredients) => {
                return ingredients.reduce((sum, item) => sum + item.price, 0).toFixed(2);
            };

            const reset = () => {
                setPatient({ name: '', age: '', sex: '', symptoms: '' });
                setSelectedProtocol(null);
            };

            const handleVoiceInput = () => {
                if (!('webkitSpeechRecognition' in window)) {
                    alert("Tu navegador no soporta voz.");
                    return;
                }
                const recognition = new window.webkitSpeechRecognition();
                recognition.lang = 'es-ES';
                recognition.onstart = () => setIsListening(true);
                recognition.onend = () => setIsListening(false);
                recognition.onresult = (e) => {
                    const transcript = e.results[0][0].transcript;
                    setPatient(prev => ({...prev, symptoms: prev.symptoms + ' ' + transcript}));
                };
                recognition.start();
            };

            const analyze = () => {
                if (!patient.symptoms.trim()) return;
                const text = patient.symptoms.toLowerCase();
                const scores = PROTOCOLS_DB.map(p => ({
                    ...p,
                    score: p.target.filter(t => text.includes(t)).length
                })).sort((a,b) => b.score - a.score);
                
                if (scores[0].score > 0) setSelectedProtocol(scores[0]);
                else alert("No se encontr√≥ coincidencia exacta.");
            };

            // --- VISTA IMPRESI√ìN ---
            if (showReport && selectedProtocol) {
                return (
                    <div className="min-h-screen bg-slate-200 p-8 flex justify-center overflow-auto">
                        <div className="fixed top-4 right-4 flex gap-2 no-print">
                            <button onClick={() => setShowReport(false)} className="bg-slate-500 text-white px-4 py-2 rounded">Cerrar</button>
                            <button onClick={() => window.print()} className="bg-medical-600 text-white px-4 py-2 rounded flex items-center gap-2">
                                <Icon name="printer" className="h-4 w-4"/> Imprimir
                            </button>
                        </div>

                        <div id="print-section" className="bg-white w-[21cm] min-h-[29.7cm] p-12 shadow-xl relative text-sm">
                             {/* Cabecera */}
                             <div className="flex justify-between border-b-2 border-medical-700 pb-4 mb-8">
                                <div className="flex gap-4 items-center">
                                    <Icon name="droplet" className="h-10 w-10 text-medical-600"/>
                                    <div>
                                        <h1 className="text-2xl font-bold text-slate-800">CL√çNICA 4 ELEMENTS</h1>
                                        <p className="text-medical-600 font-bold">PROTOCOLOS IV</p>
                                    </div>
                                </div>
                                <div className="text-right text-slate-500 text-xs">
                                    <p>Orden de Tratamiento Interno</p>
                                    <p>C. Ave Maria 29, L'Escala</p>
                                </div>
                            </div>

                            {/* Paciente */}
                            <div className="bg-slate-50 p-4 rounded border border-slate-200 mb-6">
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <span className="text-xs text-slate-400 uppercase font-bold">Paciente</span>
                                        <p className="text-lg font-bold capitalize">{patient.name || "Sin Nombre"}</p>
                                    </div>
                                    <div className="text-right">
                                        <span className="text-xs text-slate-400 uppercase font-bold">Fecha</span>
                                        <p>{new Date().toLocaleDateString()}</p>
                                    </div>
                                    <div className="col-span-2 border-t pt-2 flex gap-6 text-xs text-slate-600">
                                        <p>Edad: <b>{patient.age}</b></p>
                                        <p>Sexo: <b>{patient.sex}</b></p>
                                    </div>
                                </div>
                            </div>

                            {/* Protocolo */}
                            <div className="mb-6">
                                <h2 className="text-xl font-bold text-medical-800 mb-1">{selectedProtocol.name}</h2>
                                <p className="text-slate-500 italic mb-4">{selectedProtocol.subtext}</p>
                                
                                <div className="grid grid-cols-2 gap-4 text-xs mb-4">
                                    <div className="bg-blue-50 p-2 rounded border border-blue-100">
                                        <span className="font-bold block text-blue-800">Tiempo estimado:</span>
                                        {selectedProtocol.time}
                                    </div>
                                    <div className="bg-blue-50 p-2 rounded border border-blue-100">
                                        <span className="font-bold block text-blue-800">Velocidad infusi√≥n:</span>
                                        {selectedProtocol.speed}
                                    </div>
                                </div>

                                <div className="border border-red-200 bg-red-50 p-3 rounded mb-6">
                                    <div className="flex items-center gap-2 text-red-700 font-bold mb-1">
                                        <Icon name="alert" className="h-4 w-4"/> ALERTAS Y PRECAUCIONES
                                    </div>
                                    <p className="text-red-600 text-xs">{selectedProtocol.alerts}</p>
                                </div>

                                <table className="w-full text-sm border-collapse">
                                    <thead>
                                        <tr className="bg-slate-100 text-slate-600">
                                            <th className="p-2 text-left">Componente</th>
                                            <th className="p-2 text-right">Dosis (ml)</th>
                                            <th className="p-2 text-right w-20">Check</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {selectedProtocol.ingredients.map((ing, i) => (
                                            <tr key={i} className={ing.type === 'base' ? 'bg-medical-50 font-bold' : ''}>
                                                <td className="p-3">{ing.name}</td>
                                                <td className="p-3 text-right font-mono">{ing.qty} {ing.unit}</td>
                                                <td className="p-3"><div className="w-4 h-4 border border-slate-300 mx-auto"></div></td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>

                            {/* Costes (Interno) */}
                            <div className="mt-8 pt-4 border-t border-dashed border-slate-300 flex justify-end">
                                <div className="bg-slate-100 px-4 py-2 rounded text-right">
                                    <p className="text-xs text-slate-500 font-bold uppercase">Coste Estimado Material</p>
                                    <p className="text-lg font-mono font-bold text-slate-700">{calculateTotalCost(selectedProtocol.ingredients)} ‚Ç¨</p>
                                </div>
                            </div>

                            {/* Firma */}
                            <div className="absolute bottom-12 right-12 text-center w-64">
                                <div className="border-b border-slate-800 mb-2"></div>
                                <p className="font-bold text-slate-800">Fdo. Dra. Macias</p>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- VISTA DASHBOARD ---
            return (
                <div className="min-h-screen bg-slate-100 pb-12">
                    {/* Header */}
                    <header className="bg-medical-800 text-white shadow-lg sticky top-0 z-50">
                        <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-white/10 p-2 rounded-full"><Icon name="droplet" className="h-6 w-6"/></div>
                                <div>
                                    <h1 className="font-bold text-lg leading-none">CL√çNICA 4 ELEMENTS</h1>
                                    <p className="text-xs text-medical-200">Protocolos IV</p>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto p-4 grid lg:grid-cols-12 gap-6 mt-4">
                        
                        {/* PANEL IZQUIERDO: PACIENTE */}
                        <div className="lg:col-span-4 space-y-4">
                            <div className="bg-white p-5 rounded-xl shadow border border-slate-200 sticky top-24">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="font-bold text-slate-700 flex gap-2 items-center"><Icon name="user" className="h-5 w-5"/> Datos Paciente</h2>
                                    <button onClick={reset} className="text-slate-400 hover:text-red-500"><Icon name="trash" className="h-4 w-4"/></button>
                                </div>
                                <div className="space-y-3">
                                    <input type="text" placeholder="Nombre" className="w-full p-2 border rounded" value={patient.name} onChange={e=>setPatient({...patient, name:e.target.value})}/>
                                    <div className="flex gap-2">
                                        <input type="number" placeholder="Edad" className="w-1/3 p-2 border rounded" value={patient.age} onChange={e=>setPatient({...patient, age:e.target.value})}/>
                                        <select className="w-2/3 p-2 border rounded" value={patient.sex} onChange={e=>setPatient({...patient, sex:e.target.value})}>
                                            <option value="">Sexo</option>
                                            <option>Mujer</option>
                                            <option>Hombre</option>
                                        </select>
                                    </div>
                                    <div className="relative">
                                        <textarea placeholder="S√≠ntomas (Dictar o escribir)..." className="w-full p-2 border rounded h-24" value={patient.symptoms} onChange={e=>setPatient({...patient, symptoms:e.target.value})}></textarea>
                                        <button onClick={handleVoiceInput} className={`absolute right-2 bottom-2 p-2 rounded-full ${isListening ? 'bg-red-500 text-white animate-pulse' : 'bg-slate-200 text-slate-600'}`}>
                                            <Icon name="mic" className="h-4 w-4"/>
                                        </button>
                                    </div>
                                    <button onClick={analyze} className="w-full bg-medical-600 text-white p-3 rounded font-bold shadow hover:bg-medical-700 flex justify-center gap-2">
                                        <Icon name="search" className="h-4 w-4"/> Buscar Protocolo
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* PANEL DERECHO: PROTOCOLOS */}
                        <div className="lg:col-span-8">
                            {selectedProtocol ? (
                                <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-medical-100 fade-in">
                                    <div className="bg-medical-50 p-6 border-b border-medical-100">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h2 className="text-2xl font-bold text-medical-800">{selectedProtocol.name}</h2>
                                                <p className="text-medical-600 font-medium">{selectedProtocol.subtext}</p>
                                            </div>
                                            <div className="text-right">
                                                <div className="bg-white px-3 py-1 rounded border border-medical-100 text-sm font-bold text-medical-700 shadow-sm flex items-center gap-2">
                                                    <Icon name="clock" className="h-4 w-4"/> {selectedProtocol.time}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="mt-4 p-3 bg-red-50 border border-red-100 rounded text-sm text-red-700 flex gap-2 items-start">
                                            <Icon name="alert" className="h-5 w-5 flex-shrink-0 mt-0.5"/>
                                            <div>
                                                <span className="font-bold block">ALERTAS:</span>
                                                {selectedProtocol.alerts}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="p-6">
                                        <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2"><Icon name="package" className="h-5 w-5"/> Formulaci√≥n (ml)</h3>
                                        <div className="space-y-2 mb-6">
                                            {selectedProtocol.ingredients.map((ing, i) => (
                                                <div key={i} className={`flex justify-between items-center p-3 rounded border ${ing.type==='base' ? 'bg-blue-50 border-blue-200' : 'bg-slate-50 border-slate-100'}`}>
                                                    <span className="font-medium text-slate-700">{ing.name}</span>
                                                    <span className="font-mono font-bold text-medical-700 bg-white px-2 py-1 rounded border">{ing.qty} {ing.unit}</span>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="flex justify-between items-center border-t pt-4">
                                            <div className="flex gap-2 items-center text-slate-500 bg-slate-100 px-3 py-1 rounded">
                                                <Icon name="euro" className="h-4 w-4"/> Coste Material: <span className="font-bold text-slate-700">{calculateTotalCost(selectedProtocol.ingredients)} ‚Ç¨</span>
                                            </div>
                                            <button onClick={() => setShowReport(true)} className="bg-medical-600 hover:bg-medical-700 text-white px-6 py-3 rounded-lg font-bold shadow flex items-center gap-2 transition">
                                                <Icon name="printer" className="h-5 w-5"/> Generar Orden PDF
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div>
                                    <h3 className="font-bold text-slate-700 mb-4">Selecci√≥n R√°pida</h3>
                                    <div className="grid sm:grid-cols-2 gap-4">
                                        {PROTOCOLS_DB.map(p => (
                                            <button key={p.id} onClick={() => { setSelectedProtocol(p); window.scrollTo({top:0, behavior:'smooth'}); }} 
                                                className="bg-white p-4 rounded-xl border hover:border-medical-400 hover:shadow-md transition text-left group">
                                                <div className="font-bold text-medical-700 group-hover:text-medical-600">{p.name}</div>
                                                <div className="text-xs text-slate-500">{p.subtext}</div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SueroterapiaApp />);
    </script>
</body>
</html>
